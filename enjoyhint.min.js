var EnjoyHint=function(t){var d=this,e=$.extend({onStart:function(){},onEnd:function(){}},t),n=[],u=0;_=$("body");var o=function(t){t.preventDefault()},i=function(){_=$("body"),$(".enjoyhint").remove(),$("body").css({overflow:"auto"}),$(document).off("touchmove",o)};d.clear=function(){$(".enjoyhint_next_btn").removeClass(d.nextUserClass),$(".enjoyhint_next_btn").text("Next"),$(".enjoyhint_skip_btn").removeClass(d.skipUserClass),$(".enjoyhint_skip_btn").text("Skip")};var _=$("body"),f=function(){if(n&&n[u]){$(".enjoyhint").removeClass("enjoyhint-step-"+u),$(".enjoyhint").addClass("enjoyhint-step-"+(u+1));var p=n[u];p.onBeforeStart&&"function"==typeof p.onBeforeStart&&p.onBeforeStart();var t=p.timeout||0;setTimeout(function(){if(!p.selector)for(var t in p)p.hasOwnProperty(t)&&t.split(" ")[1]&&(p.selector=t.split(" ")[1],p.event=t.split(" ")[0],"next"!=t.split(" ")[0]&&"auto"!=t.split(" ")[0]&&"custom"!=t.split(" ")[0]||(p.event_type=t.split(" ")[0]),p.description=p[t]);setTimeout(function(){d.clear()},250),$(document.body).scrollTo(p.selector,p.scrollAnimationSpeed||250,{offset:-100}),setTimeout(function(){var t=$(p.selector),e=y(p.event);_.enjoyhint("show"),_.enjoyhint("hide_next");var n=t;if(p.event_selector&&(n=$(p.event_selector)),p.event_type||"key"!=p.event||t.keydown(function(t){t.which==p.keyCode&&(u++,f())}),1==p.showNext&&_.enjoyhint("show_next"),0==p.showSkip?_.enjoyhint("hide_skip"):_.enjoyhint("show_skip"),p.showSkip,p.nextButton&&($(".enjoyhint_next_btn").addClass(p.nextButton.className||""),$(".enjoyhint_next_btn").text(p.nextButton.text||"Next"),d.nextUserClass=p.nextButton.className),p.skipButton&&($(".enjoyhint_skip_btn").addClass(p.skipButton.className||""),$(".enjoyhint_skip_btn").text(p.skipButton.text||"Skip"),d.skipUserClass=p.skipButton.className),p.event_type)switch(p.event_type){case"auto":return t[p.event](),p.event,u++,void f();case"custom":x(p.event,function(){u++,v(p.event),f()});break;case"next":_.enjoyhint("show_next")}else n.on(e,function(t){p.keyCode&&t.keyCode!=p.keyCode||(u++,$(this).off(e),f())});var o=Math.max(t.outerWidth(),t.outerHeight()),i=p.radius||Math.round(o/2)+5,r=t.offset(),s=t.outerWidth(),h=t.outerHeight(),a=void 0!==p.margin?p.margin:10,c={x:r.left+Math.round(s/2),y:r.top+Math.round(h/2)-$(document).scrollTop()},l={center_x:c.x,center_y:c.y,text:p.description,top:p.top,bottom:p.bottom,left:p.left,right:p.right,margin:p.margin,scroll:p.scroll};p.shape&&"circle"==p.shape?(l.shape="circle",l.radius=i):(l.radius=0,l.width=s+a,l.height=h+a),_.enjoyhint("render_label_with_shape",l)},p.scrollAnimationSpeed+20||270)},t)}else _.enjoyhint("hide"),e.onEnd(),i()},r=function(){u++,f()},s=function(){var t=n[u],e=$(t.selector);v(t.event),e.off(y(t.event)),i()},y=function(t,e){return t+(e?"custom":"")+".enjoy_hint"},x=function(t,e){_.on(y(t,!0),e)},v=function(t){_.off(y(t,!0))};d.runScript=function(){u=0,e.onStart(),f()},d.resumeScript=function(){f()},d.getCurrentStep=function(){return u},d.trigger=function(t){switch(t){case"next":r();break;case"skip":s()}},d.setScript=function(t){t&&(n=t)},d.set=function(t){d.setScript(t)},d.setSteps=function(t){d.setScript(t)},d.run=function(){d.runScript()},d.resume=function(){d.resumeScript()},$(".enjoyhint")&&$(".enjoyhint").remove(),$("body").css({overflow:"hidden"}),$(document).on("touchmove",o),_.enjoyhint({onNextClick:function(){r()},onSkipClick:function(){s()}})};CanvasRenderingContext2D.prototype.roundRect=function(t,e,n,o,i){return n<2*i&&(i=n/2),o<2*i&&(i=o/2),this.beginPath(),this.moveTo(t+i,e),this.arcTo(t+n,e,t+n,e+o,i),this.arcTo(t+n,e+o,t,e+o,i),this.arcTo(t,e+o,t,e,i),this.arcTo(t,e,t+n,e,i),this.closePath(),this},function(_){var e={init:function(c){return this.each(function(){this.enjoyhint_obj={};var V=this.enjoyhint_obj,t=_(this);_("body");function a(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var o in e)n.setAttribute(o,e[o]);return n}V.options=jQuery.extend({onNextClick:function(){},onSkipClick:function(){},animation_time:800},c),V.gcl={chooser:"enjoyhint"},V.cl={enjoy_hint:"enjoyhint",hide:"enjoyhint_hide",disable_events_element:"enjoyhint_disable_events",btn:"enjoyhint_btn",skip_btn:"enjoyhint_skip_btn",close_btn:"enjoyhint_close_btn",next_btn:"enjoyhint_next_btn",main_canvas:"enjoyhint_canvas",main_svg:"enjoyhint_svg",svg_wrapper:"enjoyhint_svg_wrapper",svg_transparent:"enjoyhint_svg_transparent",kinetic_container:"kinetic_container"},V.canvas_size={w:1.4*_(window).width(),h:1.4*_(window).height()};V.enjoyhint=_("<div>",{class:V.cl.enjoy_hint+" "+V.cl.svg_transparent}).appendTo(t),V.enjoyhint_svg_wrapper=_("<div>",{class:V.cl.svg_wrapper+" "+V.cl.svg_transparent}).appendTo(V.enjoyhint),V.$stage_container=_('<div id="'+V.cl.kinetic_container+'">').appendTo(V.enjoyhint),V.$canvas=_('<canvas id="enj_canvas" width="'+V.canvas_size.w+'" height="'+V.canvas_size.h+'" class="'+V.cl.main_canvas+'">').appendTo(V.enjoyhint),V.$svg=_('<svg width="'+V.canvas_size.w+'" height="'+V.canvas_size.h+'" class="'+V.cl.main_canvas+" "+V.cl.main_svg+'">').appendTo(V.enjoyhint_svg_wrapper);var e=_(a("defs")),n=_(a("marker",{id:"arrowMarker",viewBox:"0 0 36 21",refX:"21",refY:"10",markerUnits:"strokeWidth",orient:"auto",markerWidth:"16",markerHeight:"12"})),o=_(a("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:2",d:"M0,0 c30,11 30,9 0,20"}));e.append(n.append(o)).appendTo(V.$svg),V.kinetic_stage=new Kinetic.Stage({container:V.cl.kinetic_container,width:V.canvas_size.w,height:V.canvas_size.h}),V.layer=new Kinetic.Layer,V.rect=new Kinetic.Rect({fill:"rgba(0,0,0,0.6)",width:V.canvas_size.w,height:V.canvas_size.h});var i=_("<div>",{class:V.cl.disable_events_element}).appendTo(V.enjoyhint),r=i.clone().appendTo(V.enjoyhint),s=i.clone().appendTo(V.enjoyhint),h=i.clone().appendTo(V.enjoyhint);V.$skip_btn=_("<div>",{class:V.cl.skip_btn}).appendTo(V.enjoyhint).html("Skip").click(function(t){V.hide(),V.options.onSkipClick()}),V.$next_btn=_("<div>",{class:V.cl.next_btn}).appendTo(V.enjoyhint).html("Next").click(function(t){V.options.onNextClick()}),V.$close_btn=_("<div>",{class:V.cl.close_btn}).appendTo(V.enjoyhint).html("").click(function(t){V.hide(),V.options.onSkipClick()}),V.$canvas.mousedown(function(t){_("canvas").css({left:"4000px"});var e=document.elementFromPoint(t.clientX,t.clientY);return _("canvas").css({left:"0px"}),_(e).click(),!1});V.shape=new Kinetic.Shape({radius:0,center_x:-130,center_y:-130,width:0,height:0,sceneFunc:function(t){var e=this.getContext("2d")._context,n=(this.pos,e.globalCompositeOperation);e.globalCompositeOperation="destination-out",e.beginPath();var o=this.attrs.center_x-Math.round(this.attrs.width/2),i=this.attrs.center_y-Math.round(this.attrs.height/2);e.roundRect(o,i,this.attrs.width,this.attrs.height,this.attrs.radius),e.fillStyle="red",e.fill(),e.globalCompositeOperation=n}}),V.shape.radius=0,V.layer.add(V.rect),V.layer.add(V.shape),V.kinetic_stage.add(V.layer);V.enjoyhint;return V.show=function(){V.enjoyhint.removeClass(V.cl.hide)},V.hide=function(){V.enjoyhint.addClass(V.cl.hide),new Kinetic.Tween({node:V.shape,duration:.002,center_x:-130,center_y:-130}).play()},V.hide(),V.hideNextBtn=function(){V.$next_btn.addClass(V.cl.hide),V.nextBtn="hide"},V.showNextBtn=function(){V.$next_btn.removeClass(V.cl.hide),V.nextBtn="show"},V.hideSkipBtn=function(){V.$skip_btn.addClass(V.cl.hide)},V.showSkipBtn=function(){V.$skip_btn.removeClass(V.cl.hide)},V.renderCircle=function(t){var e=t.r||0,n=t.x||0,o=t.y||0;new Kinetic.Tween({node:V.shape,duration:.2,center_x:n,center_y:o,width:2*e,height:2*e,radius:e}).play();var i=n-e,r=n+e,s=o-e,h=o+e;return{x:n,y:o,left:i,right:r,top:s,bottom:h,conn:{left:{x:i-20,y:o},right:{x:r+20,y:o},top:{x:n,y:s-20},bottom:{x:n,y:h+20}}}},V.renderRect=function(t){var e=t.r||0,n=t.x||0,o=t.y||0,i=t.w||0,r=t.h||0;new Kinetic.Tween({node:V.shape,duration:.2,center_x:n,center_y:o,width:i,height:r,radius:e}).play();var s=Math.round(i/2),h=Math.round(r/2),a=n-s,c=n+s,l=o-h,p=o+h;return{x:n,y:o,left:a,right:c,top:l,bottom:p,conn:{left:{x:a-20,y:o},right:{x:c+20,y:o},top:{x:n,y:l-20},bottom:{x:n,y:p+20}}}},V.renderLabel=function(t){var e=t.x||0,n=t.y||0,o=(t.text,V.getLabelElement({x:e,y:n,text:t.text})),i=o.width(),r=o.height(),s=o.offset().left,h=o.offset().left+i,a=o.offset().top-_(document).scrollTop(),c=o.offset().top+r,l={x:s-10,y:a+Math.round(r/2)},p={x:h+10,y:a+Math.round(r/2)},d={x:s+Math.round(i/2),y:a-10},u={x:s+Math.round(i/2),y:c+10};return o.detach(),setTimeout(function(){_("#enjoyhint_label").remove(),o.appendTo(V.enjoyhint)},V.options.animation_time/2),{label:o,left:s,right:h,top:a,bottom:c,conn:{left:l,right:p,top:d,bottom:u}}},V.renderArrow=function(t){var e=t.x_from||0,n=t.y_from||0,o=t.x_to||0,i=t.y_to||0,r=t.by_top_side,s=0,h=0;r?i<=n?(h=i,s=e):(h=n,s=o):i<=n?(h=n,s=o):(h=i,s=e);t.text;V.enjoyhint.addClass(V.cl.svg_transparent),setTimeout(function(){_("#enjoyhint_arrpw_line").remove();var t="M"+e+","+n+" Q"+s+","+h+" "+o+","+i;V.$svg.append(a("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:3","marker-end":"url(#arrowMarker)",d:t,id:"enjoyhint_arrpw_line"})),V.enjoyhint.removeClass(V.cl.svg_transparent)},V.options.animation_time/2)},V.getLabelElement=function(t){return _("<div>",{class:"enjoy_hint_label",id:"enjoyhint_label"}).css({top:t.y+"px",left:t.x+"px"}).html(t.text).appendTo(V.enjoyhint)},V.disableEventsNearRect=function(t){i.css({top:"0",left:"0"}).height(t.top),r.css({top:t.bottom+"px",left:"0"}),s.css({top:"0",left:"0px"}).width(t.left),h.css({top:"0",left:t.right+"px"})},V.renderLabelWithShape=function(t){var e=t.shape||"rect",n={},o=0,i=0,r=t.top||0,s=t.bottom||0,h=t.left||0,a=t.right||0;switch(e){case"circle":o=i=t.radius;var c=(u={top:t.center_y-i+r,bottom:t.center_y+i-s,left:t.center_x-o+h,right:t.center_x+o-a}).right-u.left,l=u.bottom-u.top;t.radius=Math.round(Math.min(c,l)/2),o=i=Math.round(t.radius/2);var p=Math.round(c/2),d=Math.round(l/2);t.center_x=u.left+p,t.center_y=u.top+d,n=V.renderCircle({x:t.center_x,y:t.center_y,r:t.radius});break;case"rect":o=Math.round(t.width/2),i=Math.round(t.height/2);var u={top:t.center_y-i+r,bottom:t.center_y+i-s,left:t.center_x-o+h,right:t.center_x+o-a};t.width=u.right-u.left,t.height=u.bottom-u.top,o=Math.round(t.width/2),i=Math.round(t.height/2),t.center_x=u.left+o,t.center_y=u.top+i,n=V.renderRect({x:t.center_x,y:t.center_y,w:t.width,h:t.height,r:t.radius})}var _=V.enjoyhint.width(),f=V.enjoyhint.height(),y=V.getLabelElement({x:0,y:0,text:t.text}),x=y.outerWidth(),v=y.outerHeight();y.remove();var b=t.center_y-i,m=f-(t.center_y+i),j=t.center_x-o,g=_-(t.center_x+o),w=_-t.center_x<t.center_x?"left":"right",k=f-t.center_y<t.center_y?"top":"bottom",$=150+x+40,C=150+v+40,S=o+150,T=i+150,M="left"==w?t.center_x-S-x:t.center_x+S,B="top"==k?t.center_y-T-v:t.center_y+T;b<C&&m<C&&(B=t.center_y+40),j<$&&g<$&&(M=t.center_x);var N=V.renderLabel({x:M,y:B,text:t.text});V.$next_btn.css({left:M,top:B+v+20});var z=M+V.$next_btn.width()+10;"hide"==V.nextBtn&&(z=M),V.$skip_btn.css({left:z,top:B+v+20}),V.$close_btn.css({right:10,top:10}),V.disableEventsNearRect({top:n.top,bottom:n.bottom,left:n.left,right:n.right});var E=!1,L="left",R="left",K=N.left<=n.x&&N.right>=n.x,W=N.right<n.x,A=(N.left,n.x,N.right,n.left,N.left,n.right,N.bottom<n.top),P=N.top>n.bottom,H=N.bottom>=n.y&&N.top<=n.y,U=N.bottom<=n.y&&!A,O=N.top>=n.y&&!P;function Q(t,e,n){L=t,R=e,E=n}function D(t,e,n,o,i){var r=[];(r=A?t:U?e:H?n:O?o:i)&&Q(r[0],r[1],r[2])}if(K)if(A)Q("bottom","top","top");else{if(!P)return;Q("top","bottom","bottom")}else W?D(["right","top","top"],["bottom","left","bottom"],["right","left","top"],["top","left","top"],["right","bottom","bottom"]):D(["left","top","top"],["bottom","right","bottom"],["left","right","top"],["top","right","top"],["left","bottom","bottom"]);var F=N.conn[L],X=n.conn[R],Y="top"==E;V.renderArrow({x_from:F.x,y_from:F.y,x_to:X.x,y_to:X.y,by_top_side:Y})},V.clear=function(){V.ctx.clearRect(0,0,3e3,2e3)},this})},set:function(t){return this.each(function(){this.enjoyhint_obj.setValue(t)}),this},show:function(){return this.each(function(){this.enjoyhint_obj.show()}),this},hide:function(){return this.each(function(){this.enjoyhint_obj.hide()}),this},hide_next:function(){return this.each(function(){this.enjoyhint_obj.hideNextBtn()}),this},show_next:function(){return this.each(function(){this.enjoyhint_obj.showNextBtn()}),this},hide_skip:function(){return this.each(function(){this.enjoyhint_obj.hideSkipBtn()}),this},show_skip:function(){return this.each(function(){this.enjoyhint_obj.showSkipBtn()}),this},render_circle:function(t,e,n){return this.each(function(){this.enjoyhint_obj.renderCircle(t,e,n)}),this},render_label:function(t,e,n){return this.each(function(){this.enjoyhint_obj.renderLabel(t,e,n)}),this},render_label_with_shape:function(t){return this.each(function(){this.enjoyhint_obj.renderLabelWithShape(t)}),this},clear:function(){return this.each(function(){this.enjoyhint_obj.clear()}),this},close:function(t){return this.each(function(){this.enjoyhint_obj.closePopdown()}),this}};_.fn.enjoyhint=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(_.error("Method "+t+" does not exist on $.numinput"),this):e.init.apply(this,arguments)}}(window.jQuery);